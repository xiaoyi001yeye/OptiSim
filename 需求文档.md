# 机器视觉相机参数计算器 - 需求文档

## 1. 概述

本项目是一个基于Web的机器视觉相机参数计算器。其主要目标是帮助用户根据场景、物体、相机和成像目标等参数，计算出理想的镜头焦距、视场(FOV)、像素精度、景深(DoF)和建议的ISO等关键光学系统参数，从而辅助用户为机器视觉项目选择最合适的光学配置。

## 2. 功能需求

### 2.1 输入参数

用户需要提供以下四组参数来进行计算：

#### 2.1.1 场景与物体
- **物体宽度 (mm):** 待拍摄物体的实际宽度。
- **物体高度 (mm):** 待拍摄物体的实际高度。
- **工作距离 (mm):** 镜头前端到被摄物体之间的距离。

#### 2.1.2 相机与传感器
- **传感器尺寸:** 从预设的常用传感器规格列表中选择（如 APS-C, 1", 2/3" 等）。
- **相机分辨率 (像素):** 相机传感器的水平和垂直像素数。

#### 2.1.3 成像目标
- **期望物体占画面宽度比例 (%):** 用户期望物体在最终成像中占据整个画面宽度的百分比。此参数通过一个滑块进行调节。

#### 2.1.4 曝光参数
- **光圈 (F-number):** 镜头的F值，从预设列表中选择（如 f/1.4, f/2.8, f/5.6 等）。
- **快门速度 (s):** 相机的曝光时间，从预设列表中选择（如 1/1000, 1/60, 1/30 等）。
- **光照环境:** 对当前光照条件的评估，从预设列表中选择（如 室外强光, 室内明亮, 弱光环境等），对应不同的曝光值(EV)。

### 2.2 计算逻辑

系统根据用户输入的参数，实时进行以下计算：

1.  **视场宽度 (FOV):** `视场宽度 = 物体宽度 / 期望物体占画面宽度比例`
2.  **理想镜头焦距:** `焦距 = (传感器宽度 * 工作距离) / 视场宽度`
3.  **最近标准焦距:** 从一个预定义的标准焦距列表 `[8, 12, 16, 25, 35, 50, 75, 100]` 中，找到与计算出的理想焦距最接近的值。
4.  **实际视场 (FOV):** 使用**最近标准焦距**重新计算相机能看到的物理区域大小。`实际视场宽度 = (传感器宽度 * 工作距离) / 最近标准焦距`
5.  **像素精度:** `精度 = 实际视场宽度 / 相机水平分辨率`，表示每个像素代表的实际物理尺寸。此处的`实际视场宽度`应基于**最近标准焦距**计算。
6.  **景深 (DoF):**
    - 首先计算弥散圆(Circle of Confusion, CoC)。一个常用的经验法则是 `CoC = 传感器对角线 / 1500`。
    - 然后计算超焦距。
    - 最后根据工作距离和超焦距计算近景深点和远景深点，从而得出总景深范围。
7.  **建议 ISO:**
    - 根据光圈和快门速度计算出在ISO 100下的曝光值(EV)。
    - 结合用户选择的光照环境EV，计算出为获得正常曝光所需的理论ISO值。
    - 将计算出的ISO值与标准ISO值列表进行匹配，找到最接近的标准ISO值。

### 2.3 输出结果

计算结果以卡片形式清晰地展示给用户：

- **理想镜头焦距:** 显示计算出的理论焦距值 (mm) 和最接近的标准焦距值。
- **视场 (FOV):** 显示使用**建议的标准焦距镜头**后，在当前工作距离下相机实际能拍摄到的物理区域宽度和高度 (mm)。
- **像素精度:** 显示使用**建议的标准焦距镜头**后，每个像素代表的物理尺寸 (mm/pixel)。
- **景深 (DoF):** 显示总景深长度 (mm)，并清晰标注出具体的对焦距离起止范围 (例如 `清晰范围: 476.5 ~ 523.5 mm`)。
- **建议 ISO:** 显示在当前曝光参数下，为获得正常曝光而建议使用的感光度值。

## 3. 非功能性需求

### 3.1 用户界面 (UI)

- **布局:** 页面采用响应式设计，分为左右两栏。左侧为参数输入区，右侧为结果展示区。
- **交互性:**
    - 所有输入框的数值改变后，计算结果会实时自动更新，无需手动点击计算按钮。
    - “期望物体占画面宽度比例”提供滑块输入，并实时显示当前百分比。
- **信息提示:** 每个计算结果卡片右上角都有一个信息图标，鼠标悬停时会显示一个工具提示（Tooltip），对该项结果的含义进行详细解释。
- **可视化:**
    - 提供一个“成像关系示意图”(SVG)，根据用户输入的工作距离和物体高度，动态更新示意图中的标注。
    - 示意图中的光路夹角应能动态变化，以直观地反映由**最近标准焦距**决定的**实际视场(FOV)**。

### 3.2 技术栈

- **前端框架:** 无，纯原生HTML/CSS/JavaScript。
- **CSS框架:** [Tailwind CSS](https://tailwindcss.com/) 用于快速构建UI样式。
- **字体:** 使用 Google Fonts 提供的 'Inter' 和 'Noto Sans SC' 字体。
- **脚本:** 所有计算逻辑均在客户端通过原生JavaScript实现。
